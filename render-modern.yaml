services:
  # Modern Backend Service with GraphQL, Redis, and Optimized MongoDB
  - type: web
    name: inventory-backend-modern
    env: node
    plan: free
    buildCommand: cd server && npm install && npm run build
    startCommand: cd server && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4000
      - key: MONGODB_URI
        sync: false
      - key: REDIS_HOST
        sync: false
      - key: REDIS_PORT
        value: 6379
      - key: REDIS_PASSWORD
        sync: false
      - key: JWT_SECRET
        generateValue: true
      - key: CLIENT_URL
        value: https://inventory-frontend-modern.onrender.com

  # Modern React Frontend with Vite, TypeScript, and PWA
  - type: web
    name: inventory-frontend-modern
    env: node
    plan: free
    buildCommand: cd client && npm install && npm run build
    startCommand: cd client && npm run preview -- --port $PORT --host
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: VITE_API_URL
        value: https://inventory-backend-modern.onrender.com
      - key: VITE_GRAPHQL_URL
        value: https://inventory-backend-modern.onrender.com/graphql

  # Redis Cache Service (if using Render Redis)
  - type: redis
    name: inventory-redis
    plan: free
    ipAllowList: []
    maxmemoryPolicy: allkeys-lru